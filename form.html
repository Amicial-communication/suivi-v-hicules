<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire V√©hicule</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            text-align: center;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 400px;
        }
        h2 {
            color: #333;
            margin-bottom: 10px;
        }
        .car-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .status {
            color: #666;
            margin-top: 15px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="car-icon">üöó</div>
        <h2>Carnet de Bord V√©hicule</h2>
        <div class="spinner"></div>
        <p class="status">R√©cup√©ration de votre position GPS...</p>
    </div>
    
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        
        const formBaseURL = "https://forms.office.com/Pages/ResponsePage.aspx?id=RDQOv2mwt063A5QHEWv3DDoE5SCcEXpFgCbpAazgK-pURjQ5VDQ0V09RTkNJN0xFWDNSU0tONUM1UiQlQCN0PWcu";
        
        // IDs pour la branche PRISE
        const priseMarqueID = "rba6e8b4972eb45a0ab92127c776d3a1d";
        const priseModeleID = "r861327d4ab1245668b07e0e879e84e23";
        const prisePlaqueID = "r2356d94277aa4c34b2e1ed3c2299b7e8";
        const priseGeoID = "rab7748b8af4c4539a1abe6ac3c9a0693";
        
        // IDs pour la branche RETOUR
        const retourMarqueID = "r3465abbd71d84a3eae5a11966da2ffd7";
        const retourModeleID = "r671f88129b324a2fb0ef8b1a5281a7dd";
        const retourPlaqueID = "rf0661cf74a434faba1e935fd6e62d328";
        const retourGeoID = "rc3bb29b532854c6d81277d1e8252e5e2";
        
        function redirectToForm(geoData = "") {
            let finalURL = formBaseURL;
            
            const marque = urlParams.get('marque') || '';
            const modele = urlParams.get('modele') || '';
            const plaque = urlParams.get('plaque') || '';
            
            // Pr√©-remplir TOUS les champs (prise ET retour)
            if (marque) {
                finalURL += `&${priseMarqueID}=${encodeURIComponent(marque)}`;
                finalURL += `&${retourMarqueID}=${encodeURIComponent(marque)}`;
            }
            if (modele) {
                finalURL += `&${priseModeleID}=${encodeURIComponent(modele)}`;
                finalURL += `&${retourModeleID}=${encodeURIComponent(modele)}`;
            }
            if (plaque) {
                finalURL += `&${prisePlaqueID}=${encodeURIComponent(plaque)}`;
                finalURL += `&${retourPlaqueID}=${encodeURIComponent(plaque)}`;
            }
            
            // G√©olocalisation pour les deux branches
            if (geoData) {
                finalURL += `&${priseGeoID}=${encodeURIComponent(geoData)}`;
                finalURL += `&${retourGeoID}=${encodeURIComponent(geoData)}`;
            }
            
            window.location.href = finalURL;
        }
        
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude.toFixed(6);
                    const lon = position.coords.longitude.toFixed(6);
                    const accuracy = position.coords.accuracy.toFixed(0);
                    const geoData = `${lat}, ${lon} (${accuracy}m)`;
                    redirectToForm(geoData);
                },
                function(error) {
                    console.error("Erreur g√©olocalisation:", error.message);
                    redirectToForm("Position non disponible");
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        } else {
            redirectToForm("G√©olocalisation non support√©e");
        }
    </script>
</body>
</html>
